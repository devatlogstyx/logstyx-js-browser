var Logstyx=(()=>{var et=Object.defineProperty,nt=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var N=(e,t,n)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))ot.call(t,n)&&N(e,n,t[n]);if(I)for(var n of I(t))st.call(t,n)&&N(e,n,t[n]);return e},U=(e,t)=>nt(e,rt(t));var j=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var k=j((Et,R)=>{var it=e=>{try{return e?JSON.parse(e):{}}catch(t){return{}}},at=()=>{let e="logstyx_sid",t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2];let n=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return document.cookie=`${e}=${n}; path=/; SameSite=Strict`,n};R.exports={safeParse:it,getOrSetSessionId:at}});var q=j(g=>{var{safeParse:T}=k();g.getOSFromUserAgent=e=>/Windows NT/.test(e)?"Windows":/Mac OS X/.test(e)?"MacOS":/Linux/.test(e)?"Linux":/Android/.test(e)?"Android":/iPhone|iPad|iPod/.test(e)?"iOS":"Unknown";g.getBrowserFromUserAgent=e=>/Chrome/.test(e)&&!/Edg/.test(e)?"Chrome":/Edg/.test(e)?"Edge":/Firefox/.test(e)?"Firefox":/Safari/.test(e)&&!/Chrome/.test(e)?"Safari":"Unknown";g.sendFn=(e,{body:t})=>{let n=new Blob([t],{type:"application/json"});return navigator.sendBeacon(e,n)};g.getDeviceParams=()=>{var e,t;return{type:"browser",origin:window.location.origin,os:g.getOSFromUserAgent(navigator==null?void 0:navigator.userAgent),browser:g.getBrowserFromUserAgent(navigator==null?void 0:navigator.userAgent),screen:`${(e=window==null?void 0:window.screen)==null?void 0:e.width}x${(t=window==null?void 0:window.screen)==null?void 0:t.height}`}};var lt={events:[],context:[],data:[],selector:[]},M,w=y(y({},lt),((M=window==null?void 0:window.LogstyxConfig)==null?void 0:M.tracker)||{});function ct(e){return e.closest("[data-logstyx-event]")||!w.selector||w.selector.length===0?!0:w.selector.some(t=>e.matches(t))}g.getBrowserContextExtras=e=>{let t={};return w.context.forEach(n=>{n==="event"?t.event=e:n==="url"?t.url=location.href:n==="referrer"?t.referrer=document.referrer||null:n==="pageTitle"&&(t.title=document.title||null)}),t};var ut=e=>{let t={};return w.data.forEach(n=>{n==="tag"?t.tag=e.tagName:n==="id"&&e.id?t.id=e.id:n==="class"&&e.className?t.class=e.className:n==="text"&&(t.text=(e.textContent||"").trim().slice(0,100))}),t};g.attachGlobalEventListeners=e=>{let t=new Set(w.events);document.querySelectorAll("[data-logstyx-event]").forEach(n=>{n.dataset.logstyxEvent.split(/\s+/).forEach(r=>t.add(r))}),t.forEach(n=>{document.addEventListener(n,i=>{var a,m,O,x;if(!i.target||i.target.closest("[data-logstyx-skip='true']")||!ct(i.target))return;let r=i.target.closest(`[data-logstyx-event~='${n}']`),o=!r,u=((a=r==null?void 0:r.dataset)==null?void 0:a.logstyxLevel)||"info",l=y(y(y({},T((m=r==null?void 0:r.dataset)==null?void 0:m.logstyxContext)),g.getBrowserContextExtras(n)),o?{fallback:!0}:{}),c=(O=r==null?void 0:r.dataset)!=null&&O.logstyxPayload?T(r.dataset.logstyxPayload):ut(i.target);e.setContext(l),(x=e[u])==null||x.call(e,c),e.clearContext()})})}});var G=j((At,D)=>{var dt=Object.defineProperty,_=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable,B=(e,t,n)=>t in e?dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t)=>{for(var n in t||(t={}))ft.call(t,n)&&B(e,n,t[n]);if(_)for(var n of _(t))gt.call(t,n)&&B(e,n,t[n]);return e},$=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),z=(e,t,n)=>new Promise((i,r)=>{var o=c=>{try{l(n.next(c))}catch(a){r(a)}},u=c=>{try{l(n.throw(c))}catch(a){r(a)}},l=c=>c.done?i(c.value):Promise.resolve(c.value).then(o,u);l((n=n.apply(e,t)).next())}),yt=$(e=>{e.sanitizeObject=t=>Object.entries(t).reduce((n,[i,r])=>(r!=null&&r!==""&&!(Array.isArray(r)&&r.length===0)&&!(typeof r=="object"&&!Array.isArray(r)&&Object.keys(r).length===0&&r.constructor===Object)&&(n[i]=r),n),{}),e.normalizeArgs=t=>{var n,i;let r=(o,u=0,l=new WeakSet)=>{if(o===null||typeof o!="object")return typeof o=="string"&&o.length>500?o.substring(0,500)+"... (truncated)":o;if(u>=2)return"[Max depth reached]";if(l.has(o))return"[Circular]";if(l.add(o),Array.isArray(o))return o.slice(0,10).map(a=>r(a,u+1,l));let c={};for(let a in o)a.startsWith("_")||Object.prototype.hasOwnProperty.call(o,a)&&typeof o[a]!="function"&&(c[a]=r(o[a],u+1,l));return c};if(t instanceof Error){let o={title:(i=t.name)!=null?i:(n=t==null?void 0:t.constructor)==null?void 0:n.name,message:t.message,stack:t.stack||null},u=new WeakSet;return Object.keys(t).forEach(l=>{!o[l]&&typeof t[l]!="function"&&(o[l]=r(t[l],0,u))}),o}return t==null?{message:String(t)}:Array.isArray(t)?{message:JSON.stringify(t)}:typeof t=="object"?t:{message:String(t)}}}),ht=$(e=>{var{sanitizeObject:t,normalizeArgs:n}=yt();e.useLogstyx=i=>{let{projectId:r,apiKey:o,appid:u,endpoint:l,device:c,sendFunc:a,signatureFunc:m,maxLogInQueue:O=12,onError:x}=i;typeof a!="function"&&(a=fetch);let d=[],E=!1,C=0,v=null,b={appid:u};function H(s){b=W(W({},b),s)}function K(s){if(Array.isArray(s))for(let f of s)delete b[f];else b={}}function P(s,f){if(typeof x=="function")try{x(s,f)}catch(A){}}function F(){if(!(E||v)&&d.length>0){let s=Math.min(1e3*Math.pow(2,C),3e4);v=setTimeout(V,s)}}function V(){return z(this,null,function*(){if(v&&(clearTimeout(v),v=null),!(E||d.length===0)){E=!0;try{let{level:s,data:f}=d[0];yield p(s,f,!0),d.shift(),C=0}catch(s){C++;let f=d.shift();d.push(f),P(s,{level:f.level,queueLength:d.length,consecutiveFailures:C})}finally{E=!1}F()}})}function p(s){return z(this,arguments,function*(f,A={},Y=!1){try{let L=t({level:f,projectId:r,appid:u,device:c,context:t(b),data:t(n(A))}),S={"Content-Type":"application/json"};if(typeof m=="function"){let{timestamp:Z,signature:tt}=m(r,o,L);S.signature=tt,S.timestamp=Z}return yield a(l,{method:"POST",body:JSON.stringify(L),headers:S})}catch(L){if(Y)throw L;if(d.length>=O){let S=d.shift();P(new Error("Queue full, dropping oldest log"),{dropped:S})}d.push({level:f,data:A}),F()}})}return{info:s=>p("INFO",s),warning:s=>p("WARNING",s),error:s=>p("ERROR",s),critical:s=>p("CRITICAL",s),send:p,setContext:H,clearContext:K,getQueueLength:()=>d.length}}}),{useLogstyx:pt}=ht();D.exports=e=>pt(e)});var{getOrSetSessionId:wt}=k(),{attachGlobalEventListeners:mt,getDeviceParams:xt,sendFn:vt}=q(),bt=G(),St=xt(),h,Q,J,X;if(typeof window!="undefined")if(window.LogstyxConfig&&!window.Logstyx){if(h=bt(U(y({},window.LogstyxConfig),{sendFunc:vt,device:window.LogstyxConfig.device||St})),((Q=window==null?void 0:window.LogstyxConfig)==null?void 0:Q.persistentSession)===!0){let e=wt();h.setContext({sessionId:e})}if(window.Logstyx=h,mt(h),((J=window==null?void 0:window.LogstyxConfig)==null?void 0:J.captureUncaught)===!0)try{typeof window!="undefined"&&(window.onerror=(e,t,n,i,r)=>{h.critical({title:(r==null?void 0:r.name)||"Unknown Error",message:e||(r==null?void 0:r.message),stack:(r==null?void 0:r.stack)||null})})}catch(e){console.error(e)}if(((X=window==null?void 0:window.LogstyxConfig)==null?void 0:X.captureUnhandledRejections)===!0)try{let e=t=>{let n=t instanceof Error?t.message:String(t),i=t instanceof Error?t.stack:void 0,r=t instanceof Error?t.name:"Unhandled Rejection";h.critical({title:r,message:n,stack:i})};window.onunhandledrejection=t=>e(t.reason)}catch(e){console.error(e)}}else window.Logstyx&&(h=window.Logstyx);})();
